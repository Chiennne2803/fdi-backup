<div class="flex flex-col  md:min-w-160 max-h-screen -m-6">

    <!-- Header -->
    <div class="flex flex-0 items-center justify-between h-14 pr-3 sm:pr-5 pl-6 sm:pl-8 bg-primary text-on-primary">
        <div class="text-lg font-medium" *ngIf="data">
            {{isEditable ? 'Cập nhật lãi suất và kỳ hạn vay thế chấp' : 'Chi tiết lãi suất và kỳ hạn vay thế chấp'}}
        </div>
        <div class="text-lg font-medium"
             *ngIf="!data">
            Thêm mới lãi suất và kỳ hạn vay thế chấp
        </div>
        <button mat-icon-button>
            <mat-icon class="text-current"
                      [svgIcon]="'heroicons_outline:x'"
                      (click)="back()"></mat-icon>
        </button>
    </div>

    <!-- Compose form -->

    <ng-container *ngIf="isEditable; else viewTemplate">
        <form class="flex flex-col flex-auto p-6 sm:p-8 overflow-y-auto gap-8"
              [formGroup]="creditRateForm">
            <div class="flex flex-col flex-auto gap-2 px-6 pt-4 border rounded-md">
                <div class="text-lg font-bold">Thông tin lãi suất và kỳ hạn vay thế chấp</div>
                <div class="flex flex-row w-full gap-4">
                    <mat-form-field class="w-1/2">
                        <mat-label>Xếp hạng khách hàng</mat-label>
                        <input type="text"
                               matInput
                               formControlName="creditCode"
                               [matAutocomplete]="auto">
                        <mat-autocomplete autoActiveFirstOption
                                          #auto="matAutocomplete"
                                          (optionSelected)="onOptionSelected($event)">
                            <mat-option *ngFor="let option of creditCodes | async"
                                        [value]="option.creditCode">
                                {{option.creditCode}}
                            </mat-option>
                        </mat-autocomplete>
                        <mat-error *ngIf="creditRateForm.get('creditCode').hasError('required')">
                            {{ 'SPTD001' | transloco }}
                        </mat-error>
                    </mat-form-field>
                    <mat-form-field class="w-1/2">
                        <mat-label>Kỳ hạn (Ngày)</mat-label>
                        <input id="tenor"
                               type="number"
                               maxlength="10"
                               matInput
                               formControlName="tenor">
                        <mat-error *ngIf="creditRateForm.get('tenor').hasError('required')">
                            {{ 'SPTD012' | transloco }}
                        </mat-error>
                        <mat-error *ngIf="creditRateForm.get('tenor').hasError('maxlength')">
                            {{ 'SPTD013' | transloco }}
                        </mat-error>
                    </mat-form-field>
                </div>
                <div class="flex flex-row w-full gap-4">
                    <mat-form-field class="w-1/2">
                        <mat-label>Lãi suất vay thế chấp từ (%)</mat-label>
                        <input id="minMortgateRate"
                               type="number"
                               matInput
                               formControlName="minMortgateRate">
                        <mat-error *ngIf="creditRateForm.get('minMortgateRate').hasError('required')">
                            {{ 'SPTD015' | transloco }}
                        </mat-error>
                        <mat-error *ngIf="creditRateForm.get('minMortgateRate').hasError('maxlength')">
                            {{ 'SPTD016' | transloco }}
                        </mat-error>
                        <mat-error *ngIf="creditRateForm.get('minMortgateRate').hasError('max')">
                            {{ 'SPTD017' | transloco }}
                        </mat-error>
                        <mat-error *ngIf="creditRateForm.get('minMortgateRate').hasError('min')">
                            {{ 'SPTD136' | transloco }}
                        </mat-error>
                    </mat-form-field>
                    <mat-form-field class="w-1/2">
                        <mat-label>Lãi suất vay thế chấp đến (%)</mat-label>
                        <input id="maxMortgateRate"
                               type="number"
                               matInput
                               formControlName="maxMortgateRate">
                        <mat-error *ngIf="creditRateForm.get('maxMortgateRate').hasError('required')">
                            {{ 'SPTD019' | transloco }}
                        </mat-error>
                        <mat-error *ngIf="creditRateForm.get('maxMortgateRate').hasError('maxlength')">
                            {{ 'SPTD020' | transloco }}
                        </mat-error>
                        <mat-error *ngIf="creditRateForm.get('maxMortgateRate').hasError('max')">
                            {{ 'SPTD021' | transloco }}
                        </mat-error>
                        <mat-error *ngIf="creditRateForm.get('maxMortgateRate').hasError('min')">
                            {{ 'SPTD137' | transloco }}
                        </mat-error>
                    </mat-form-field>
                </div>
                <div class="flex flex-row w-full gap-4">
                    <mat-form-field class="w-1/2">
                        <mat-label>Phí kết nối khoản huy động (%)</mat-label>
                        <input id="fee"
                               maxlength="3"
                               type="number"
                               matInput
                               formControlName="fee">
                        <mat-error *ngIf="creditRateForm.get('fee').hasError('required')">
                            {{ 'SPTD022' | transloco }}
                        </mat-error>
                        <mat-error *ngIf="creditRateForm.get('fee').hasError('maxlength')">
                            {{ 'SPTD023' | transloco }}
                        </mat-error>
                        <mat-error *ngIf="creditRateForm.get('fee').hasError('max')">
                            {{ 'SPTD024' | transloco }}
                        </mat-error>
                        <mat-error *ngIf="creditRateForm.get('fee').hasError('min')">
                            {{ 'SPTD138' | transloco }}
                        </mat-error>
                    </mat-form-field>
                    <!--<mat-form-field class="w-1/2">
                        <mat-label>Số lượng kỳ thanh toán</mat-label>
                        <input id="periodPay"
                               matInput
                               readonly
                               formControlName="periodPay">
                    </mat-form-field>-->
                    <mat-form-field class="w-1/2">
                        <mat-label>Số tiền đầu tư tối thiểu (VND)</mat-label>
                        <input id="minAmount"
                               [maxlength]="15"
                               matInput
                               currencyMask autocomplete="off"
                               class="text-left"
                               [options]="{ prefix: '', thousands: ',', precision: 0, allowNegative: false }"
                               formControlName="minAmount">
                        <mat-error *ngIf="creditRateForm.get('minAmount').hasError('required')">
                            {{ 'SPTD093' | transloco }}
                        </mat-error>
                        <mat-error *ngIf="creditRateForm.get('minAmount').hasError('maxlength')">
                            {{ 'SPTD094' | transloco }}
                        </mat-error>
                        <mat-error *ngIf="creditRateForm.get('minAmount').hasError('min')">
                            {{ 'SPTD095' | transloco }}
                        </mat-error>
                    </mat-form-field>
                </div>
                <div class="flex flex-row w-full gap-4">
                    <mat-form-field class="w-full">
                        <mat-label>Ghi chú</mat-label>
                        <textarea id="note"
                                  matInput
                                  trim="blur"
                                  maxlength="500"
                                  value="0"
                                  formControlName="note"></textarea>
                    </mat-form-field>
                </div>
            </div>

            <div class="flex flex-col flex-auto gap-2 px-6 pt-4 border rounded-md">
                <div class="text-lg font-bold">Thông tin khác</div>
                <div class="flex flex-row w-full gap-4">
                    <mat-form-field class="w-1/2">
                        <mat-label>Ngày tạo</mat-label>
                        <input id="createdDate"
                               matInput
                               readonly
                               formControlName="createdDate">
                    </mat-form-field>
                    <mat-form-field class="w-1/2">
                        <mat-label>Người tạo</mat-label>
                        <input id="createdByName"
                               matInput
                               readonly
                               formControlName="createdByName">
                    </mat-form-field>
                </div>
                <div class="flex flex-row w-full gap-4">
                    <mat-form-field class="w-1/2">
                        <mat-label>Ngày cập nhật</mat-label>
                        <input id="lastUpdatedDate"
                               matInput
                               readonly
                               formControlName="lastUpdatedDate">
                    </mat-form-field>
                    <mat-form-field class="w-1/2">
                        <mat-label>Người cập nhật</mat-label>
                        <input id="lastUpdatedByName"
                               matInput
                               readonly
                               formControlName="lastUpdatedByName">
                    </mat-form-field>
                </div>
            </div>
        </form>
    </ng-container>
    <!-- Actions -->
    <div class="flex flex-col sm:flex-row sm:items-center justify-end mb-4 sm:mb-6 pr-8 sm:pr-8 mb-8">
        <div class="flex items-center mt-4 sm:mt-0 gap-4">
            <ng-container *ngIf="data; else btnTemplate">
                <button class="fuse-mat-button-large w-48"
                        mat-stroked-button
                        (click)="back()">
                    Đóng
                </button>
                <button *ngIf="!isEditable"
                        class="fuse-mat-button-large w-48"
                        mat-flat-button
                        [color]="'primary'"
                        (click)="isEditable = true">
                    <span>Cập nhật</span>
                </button>
                <button *ngIf="isEditable"
                        class="fuse-mat-button-large w-48"
                        mat-flat-button
                        [color]="'primary'"
                        (click)="submit()">
                    <span>Lưu</span>
                </button>
            </ng-container>
            <ng-template #btnTemplate>
                <button class="fuse-mat-button-large w-48"
                        mat-stroked-button
                        (click)="back()">
                    Đóng
                </button>
                <button class="fuse-mat-button-large w-48"
                        mat-flat-button
                        [color]="'primary'"
                        (click)="submitAndReset()">
                    <span>Lưu và thêm</span>
                </button>
                <button class="fuse-mat-button-large w-48"
                        mat-flat-button
                        [color]="'primary'"
                        (click)="submit()">
                    <span>Lưu và đóng</span>
                </button>
            </ng-template>
        </div>
    </div>
</div>

<ng-template #viewTemplate>
    <div class="flex flex-col flex-auto mt-4 gap-3"
         *ngIf="detailCredit">
        <div class="flex flex-col flex-auto overflow-hidden gap-8 m-8 p-4 border rounded-md">
            <div class="text-lg font-bold">Thông tin lãi suất và kỳ hạn vay thế chấp</div>
            <div class="flex flex-row w-full gap-4 border-b border-solid ">
                <div class="w-1/2 flex flex-col gap-4">
                    <mat-label>Xếp hạng khách hàng</mat-label>
                    <strong>{{detailCredit.creditCode}}</strong>
                </div>
                <div class="w-1/2 flex flex-col gap-4">
                    <mat-label>Kỳ hạn (Ngày)</mat-label>
                    <strong>{{detailCredit.tenor}}</strong>
                </div>
            </div>
            <div class="flex flex-row w-full gap-4 border-b border-solid ">
                <div class="w-1/2 flex flex-col gap-4">
                    <mat-label>Lãi suất vay thế chấp từ (%)</mat-label>
                    <strong>{{detailCredit.minMortgateRate}}</strong>
                </div>
                <div class="w-1/2 flex flex-col gap-4">
                    <mat-label>Lãi suất vay thế chấp đến (%)</mat-label>
                    <strong>{{ detailCredit.maxMortgateRate }}</strong>
                </div>
            </div>
            <div class="flex flex-row w-full gap-4 border-b border-solid ">
                <div class="w-1/2 flex flex-col gap-4">
                    <mat-label>Phí (%)</mat-label>
                    <strong>{{detailCredit.fee}}</strong>
                </div>
                <!--<div class="w-1/2 flex flex-col gap-4">
                    <mat-label>Số lượng kỳ thanh toán</mat-label>
                    <strong>{{detailCredit.periodPay}}</strong>
                </div>-->
                <div class="w-1/2 flex flex-col gap-4">
                    <mat-label>Số tiền đầu tư tối thiểu (VND)</mat-label>
                    <strong>{{detailCredit.minAmount | currencyFormatPipe: 3}}</strong>
                </div>
            </div>
            <div class="flex flex-row w-full gap-4 border-b border-solid ">
                <div class="w-full flex flex-col gap-4">
                    <mat-label>Ghi chú</mat-label>
                    <strong>{{detailCredit.note }}</strong>
                </div>
            </div>

            <div class="text-lg font-bold">Thông tin khác: </div>
            <div class="flex flex-row w-full gap-4 border-b border-solid ">
                <div class="w-1/2 flex flex-col gap-4">
                    <mat-label>Ngày tạo</mat-label>
                    <strong>{{detailCredit.createdDate | datetimeformat: 'DD/MM/YYYY' }}</strong>
                </div>
                <div class="w-1/2 flex flex-col gap-4">
                    <mat-label>Người tạo</mat-label>
                    <strong>{{detailCredit.createdByName}}</strong>
                </div>
            </div>
            <div class="flex flex-row w-full gap-4 border-b border-solid ">
                <div class="w-1/2 flex flex-col gap-4">
                    <mat-label>Ngày cập nhật</mat-label>
                    <strong>{{detailCredit.lastUpdatedDate | datetimeformat: 'DD/MM/YYYY' }}</strong>
                </div>
                <div class="w-1/2 flex flex-col gap-4">
                    <mat-label>Người cập nhật</mat-label>
                    <strong>{{detailCredit.lastUpdatedByName}}</strong>
                </div>
            </div>
        </div>
    </div>
</ng-template>
