<change-id-gpkd></change-id-gpkd>
<mat-drawer class="w-full sm:w-100" [mode]="'side'" [opened]="false" [position]="'end'" #fileDrawer>
    <file-detail [fileDrawer]="fileDrawer" [selectedFile]="selectedFile"></file-detail>
</mat-drawer>
<div class="relative min-w-0 p-4">
    <div class="flex-auto">
        <div class="flex flex-col">
            <ng-container *ngIf="isEditable; else viewTemplate">
                <div class="flex flex-col flex-auto mb-4" [formGroup]="representativeDetailForm">
                    <div class="border border-primary-grayLight-2 rounded-lg p-4">
                        <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 sm:gap-x-4">
                            <div class="row-span-1 col-span-4 md:row-span-3 md:col-span-1">
                                <avatar-component-shared styleClass="h-[220px]" [formGroup]="representativeDetailForm"
                                    field="avatar"></avatar-component-shared>
                            </div>
                            <mat-form-field class="col-span-4 sm:col-span-1 mt-2 sm:mt-0">
                                <mat-label>Họ và tên</mat-label>
                                <input id="fullName" matInput trim="blur" maxlength="50" formControlName="fullName">
                                <mat-error *ngIf="representativeDetailForm.get('fullName').hasError('required')">
                                    {{ 'HSVV276' | transloco }}
                                </mat-error>
                            </mat-form-field>
                            <mat-form-field class="col-span-4 sm:col-span-1">
                                <mat-label>SĐT liên hệ</mat-label>
                                <input id="mobile" matInput maxlength="11" inputMask maskType="number"
                                    formControlName="mobile">
                                <mat-error *ngIf="!!getErrorMobile()">
                                    {{ getErrorMobile() | transloco }}
                                </mat-error>
                            </mat-form-field>
                            <mat-form-field class="col-span-4 sm:col-span-1">
                                <mat-label>Email</mat-label>
                                <input id="email" matInput maxlength="100" formControlName="email">
                                <mat-error *ngIf="representativeDetailForm.get('email').hasError('required')">
                                    {{ 'TKDT103' | transloco }}
                                </mat-error>
                                <mat-error *ngIf="representativeDetailForm.get('email').hasError('maxlength')">
                                    {{ 'TKDT102' | transloco }}
                                </mat-error>
                                <mat-error *ngIf="representativeDetailForm.get('email').hasError('email')">
                                    {{ 'TKDT104' | transloco }}
                                </mat-error>
                            </mat-form-field>
                            <mat-form-field class="col-span-4 sm:col-span-1">
                                <mat-label>CCCD/Hộ chiếu</mat-label>
                                <input id="identification" matInput inputMask maskType="number" trim="blur"
                                    maxlength="12" formControlName="identification">
                                <mat-error *ngIf="representativeDetailForm.get('identification').hasError('required')">
                                    {{ 'TKDT088' | transloco }}
                                </mat-error>
                            </mat-form-field>
                            <app-date-picker class="col-span-4 sm:col-span-1" label="Ngày cấp" [maxDate]="{'days': 0}"
                                formControlName="idDate" [isRequired]="true" requiredMsg="TKDT091" fomatMsg="HSVV281"
                                maxMsg="HSVV282"></app-date-picker>
                            <mat-form-field class="col-span-4 sm:col-span-1">
                                <mat-label>Nơi cấp</mat-label>
                                <input id="idAddress" matInput maxlength="100" formControlName="idAddress">
                                <mat-error *ngIf="representativeDetailForm.get('idAddress').hasError('required')">
                                    {{ 'TKDT093' | transloco }}
                                </mat-error>
                                <mat-error *ngIf="representativeDetailForm.get('idAddress').hasError('maxlength')">
                                    {{ 'TKDT092' | transloco }}
                                </mat-error>
                            </mat-form-field>
                            <mat-form-field class="col-span-4 sm:col-span-1">
                                <mat-label>Giới tính</mat-label>
                                <mat-select formControlName="gender">
                                    <mat-option *ngFor="let item of genders" [value]="item.admCategoriesId">{{
                                        item.categoriesName }}
                                    </mat-option>
                                </mat-select>
                                <mat-error *ngIf="representativeDetailForm.get('gender').hasError('required')">
                                    {{ 'TKDT094' | transloco }}
                                </mat-error>
                            </mat-form-field>
                            <app-date-picker class="col-span-4 sm:col-span-1" label="Ngày sinh"
                                [maxDate]="{'months': -216}" [validationType]="['upper18']"
                                formControlName="dateOfBirth" [isRequired]="true" requiredMsg="TKDT097"
                                fomatMsg="TKDT153" maxMsg="HSVV194"></app-date-picker>
                            <mat-form-field class="col-span-4 sm:col-span-1">
                                <mat-label>MST cá nhân</mat-label>
                                <input id="taxCode" inputMask maskType="number" matInput maxlength="13"
                                    formControlName="taxCode"
                                    placeholder=" Nhập '0' nếu chưa có Mã số thuế">
                                <mat-error *ngIf="representativeDetailForm.get('taxCode').hasError('maxlength')">
                                    {{ 'TKDT105' | transloco }}
                                </mat-error>
                            </mat-form-field>
                            <mat-form-field class="col-span-4 sm:col-span-1">
                                <mat-label>Chức vụ</mat-label>
                                <input matInput formControlName="positionCompany">
                                <mat-error *ngIf="representativeDetailForm.get('positionCompany').hasError('required')">
                                    {{ 'TKDT107' | transloco }}
                                </mat-error>
                                <mat-error
                                    *ngIf="representativeDetailForm.get('positionCompany').hasError('maxlength')">
                                    {{ 'TKDT106' | transloco }}
                                </mat-error>
                            </mat-form-field>
                            <mat-form-field class="col-span-4 sm:col-span-1">
                                <mat-label>Trang Facebook</mat-label>
                                <input id="facebook" matInput formControlName="facebook">
                                <mat-error *ngIf="representativeDetailForm.get('facebook').hasError('maxlength')">
                                    {{ 'TKDT108' | transloco }}
                                </mat-error>
                            </mat-form-field>
                            <mat-form-field class="col-span-4 sm:col-span-1">
                                <mat-label>Địa chỉ thường trú</mat-label>
                               <input class="cursor-pointer" matInput readonly formControlName="address1"
                                    (click)="openAddressDialog('address1')">
                                <mat-error *ngIf="representativeDetailForm.get('address1').hasError('required')">
                                    {{ 'TKDT109' | transloco }}
                                </mat-error>
                            </mat-form-field>
                            <mat-form-field class="col-span-4 sm:col-span-1">
                                <mat-label>Địa chỉ hiện tại</mat-label>
                                 <input id="address2" class="cursor-pointer" matInput readonly formControlName="address2"
                                    (click)="openAddressDialog('address2')">
                                <mat-error *ngIf="representativeDetailForm.get('address2').hasError('required')">
                                    {{ 'TKDT110' | transloco }}
                                </mat-error>
                            </mat-form-field>
                            <div class="col-span-4 sm:col-span-2">
                                <app-dropzone inputId="frontPhotoIdentication" styleClass="w-full max-h-15"
                                    [maxFile]="1" topTitle="Ảnh CCCD/Hộ chiếu mặt trước"
                                    title="Ảnh CCCD/Hộ chiếu mặt trước *" [maxFileSize]="5"
                                    accept="image/png, image/jpg, image/jpeg" [formGroup]="representativeDetailForm"
                                    field="frontPhotoIdentication" [isRequired]="true" [multiple]="false"
                                    requiredMsg="QLDT110" typeMsg="QLDT111" sizeMsg="QLDT112"></app-dropzone>
                            </div>
                            <div class="col-span-4 sm:col-span-2">
                                <app-dropzone inputId="backsitePhotoIdentication" field="backsitePhotoIdentication"
                                    styleClass="w-full max-h-15" [maxFile]="1" [multiple]="false" [isRequired]="true"
                                    topTitle="Ảnh CCCD/Hộ chiếu mặt sau" title="Ảnh CCCD/Hộ chiếu mặt sau *"
                                    [maxFileSize]="5" accept="image/png, image/jpg, image/jpeg"
                                    [formGroup]="representativeDetailForm" requiredMsg="QLDT114" typeMsg="QLDT115"
                                    sizeMsg="QLDT116"></app-dropzone>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="flex flex-row justify-end mt-4">
                    <button mat-stroked-button (click)="cancel()">
                        Đóng
                    </button>
                    <button class="ml-2" mat-flat-button [color]="'primary'" (click)="update()">
                        Lưu
                    </button>
                </div>
            </ng-container>
            <ng-template #viewTemplate>
                <div class="flex flex-col flex-auto">
                    <div class="border border-primary-grayLight-2 rounded-lg p-4">
                        <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
                            <div class="row-span-1 col-span-2 md:row-span-3 md:col-span-1">
                                <avatar-component-shared styleClass="h-[220px] aspect-[9/6]"
                                    [fileFromServer]="representativeDetail?.avatar"
                                    [showFileButton]="false"></avatar-component-shared>
                            </div>
                            <div class="flex flex-col col-span-1 gap-2">
                                <mat-label>Họ và tên</mat-label>
                                <strong>{{representativeDetail?.fullName}}</strong>
                            </div>
                            <div class="flex flex-col col-span-1 gap-2">
                                <mat-label>SĐT liên hệ</mat-label>
                                <strong>{{representativeDetail?.mobile}}</strong>
                            </div>
                            <div class="flex flex-col col-span-1 gap-2">
                                <mat-label>Email</mat-label>
                                <strong class="text-blue-500 underline">
                                    <a
                                        [href]="'mailto:' + representativeDetail?.email">{{representativeDetail?.email}}</a>
                                </strong>
                            </div>
                            <div class="flex flex-col col-span-1 gap-2">
                                <mat-label>CCCD/Hộ chiếu</mat-label>
                                <strong>{{representativeDetail?.identification}}</strong>
                            </div>
                            <div class="flex flex-col col-span-1 gap-2">
                                <mat-label>Ngày cấp</mat-label>
                                <strong>{{representativeDetail?.idDate | date: 'dd/MM/YYYY'}}</strong>
                            </div>
                            <div class="flex flex-col col-span-1 gap-2">
                                <mat-label>Nơi cấp</mat-label>
                                <strong>{{representativeDetail?.idAddress}}</strong>
                            </div>
                            <div class="flex flex-col col-span-1 gap-2">
                                <mat-label>Giới tính</mat-label>
                                <strong>{{representativeDetail?.genderName}}</strong>
                            </div>
                            <div class="flex flex-col col-span-1 gap-2">
                                <mat-label>Ngày sinh</mat-label>
                                <strong>{{representativeDetail?.dateOfBirth | date: 'dd/MM/YYYY'}}</strong>
                            </div>
                            <div class="flex flex-col col-span-1 gap-2">
                                <mat-label>MST cá nhân</mat-label>
                                <strong>{{representativeDetail?.taxCode}}</strong>
                            </div>
                            <div class="flex flex-col col-span-1 gap-2">
                                <mat-label>Chức vụ</mat-label>
                                <strong>{{representativeDetail?.positionCompany}}</strong>
                            </div>
                            <div class="flex flex-col col-span-1 gap-2">
                                <mat-label>Trang facebook</mat-label>
                                <strong>{{representativeDetail?.facebook}}</strong>
                            </div>
                            <div class="flex flex-col col-span-2 sm:col-span-1  gap-2">
                                <mat-label>Địa chỉ thường trú</mat-label>
                                <strong>{{representativeDetail?.address2}}</strong>
                            </div>
                            <div class="flex flex-col col-span-2 sm:col-span-1 gap-2">
                                <mat-label>Địa chỉ hiện tại</mat-label>
                                <strong>{{representativeDetail?.address1}}</strong>
                            </div>
                            <div class="flex flex-col col-span-2 gap-2">
                                <mat-label>Ảnh CCCD/Hộ chiếu(Mặt trước):</mat-label>
                                <span class="text-primary underline cursor-pointer"
                                    (click)="clickViewImage(representativeDetail?.frontPhotoIdentication)">Xem
                                    file</span>
                            </div>
                            <div class="flex flex-col col-span-2 gap-2">
                                <mat-label>Ảnh CCCD/Hộ chiếu(Mặt sau):</mat-label>
                                <span class="text-primary underline cursor-pointer"
                                    (click)="clickViewImage(representativeDetail?.backsitePhotoIdentication)">Xem
                                    file</span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="flex justify-end mt-4">
                    <button mat-flat-button [color]="'primary'" (click)="edit()">
                        <span>Cập nhật</span>
                    </button>
                </div>
            </ng-template>
        </div>
    </div>
</div>