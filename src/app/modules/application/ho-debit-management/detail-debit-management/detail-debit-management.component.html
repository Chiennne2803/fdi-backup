<mat-drawer-container
    class="flex-auto h-full bg-card dark:bg-transparent">

    <mat-drawer
        class="w-11/12 sm:w-100"
        [mode]="'side'"
        [opened]="false"
        [position]="'end'"
        #fileDrawer>
        <file-detail
            [fileDrawer]="fileDrawer"
            [selectedFile]="selectedFile"
        ></file-detail>
    </mat-drawer>
    <mat-drawer-content class="flex flex-col" *ngIf="viewMode == 1"
                        @fadeOutLeft
                        @slideInLeft>
        <div class="flex flex-col w-full p-5">
            <ng-container *ngIf="(debtManagement | async) as debtManagementData">
                <div class="relative w-full px-5">
                    <div class="flex items-center justify-between w-full mx-auto py-2">
                        <article class="prose break-words">
                            <h3>
                                Thông tin chi tiết công nợ
                            </h3>
                        </article>
                        <div class="flex items-center justify-end">
                            <a
                                (click)="onClose()"
                                class="ml-auto sm:ml-0"
                                mat-stroked-button
                                [matTooltip]="'Đóng'"
                            >
                                Đóng
                            </a>
                            <a @fadeInRight
                               *ngIf="fsReportDebtManagers.status == 1 && ( 'SFF_MANAGEMENT_DEBT_APPROVE' | permission)"
                               (click)="onClickCreateHistory(debtManagementData)"
                               mat-flat-button
                               color="primary"
                               class="ml-5"
                               [matTooltip]="'Tạo ghi nhận xử lý'">
                                Tạo ghi nhận xử lý
                            </a>
                            <a @fadeInRight
                               *ngIf="fsReportDebtManagers.status == 1 && ( 'SFF_MANAGEMENT_DEBT_APPROVE' | permission)"
                               (click)="onClickApprove(debtManagementData.fsLoanProfilesId)"
                               mat-flat-button
                               color="primary"
                               class="ml-5"
                               [matTooltip]="'Xử lý'">
                                Xử lý
                            </a>
                        </div>
                    </div>
                </div>
                <ng-container >
                    <div class="grid grid-cols-4 gap-5 p-5 border-b">
                        <article class="prose break-words">
                            <p>Hồ sơ huy động vốn: <br> <b>{{ debtManagementData.fsLoanProfilesId }}</b></p>
                        </article>
                        <article class="prose break-words">
                            <p>Bên huy động vốn: <br> <b>{{ debtManagementData.fullName }}</b></p>
                        </article>
                        <article class="prose break-words">
                            <p>Lãi suất: <br> <b>{{ debtManagementData.rate }} %</b></p>
                        </article>
                        <article class="prose break-words">
                            <p>Kỳ hạn vay(ngày): <br> <b>{{ debtManagementData.loanTimeCycle }}</b></p>
                        </article>
                        <article class="prose break-words">
                            <p>Số tiền huy động (VNĐ): <br> <b>{{ debtManagementData.totalAmount | currencyFormatPipe : 10 }}</b></p>
                        </article>
                        <article class="prose break-words">
                            <p>Lãi dự kiến (VNĐ): <br> <b>{{ debtManagementData.totalAmountInteres | currencyFormatPipe : 10 }}</b></p>
                        </article>
                        <article class="prose break-words">
                            <p>Gốc đã trả (VNĐ): <br> <b>{{ (debtManagementData.payAmount) | currencyFormatPipe : 10 }}</b></p>
                        </article>
                        <article class="prose break-words">
                            <p>Nợ gốc còn lại (VNĐ): <br> <b>{{ debtManagementData.totalAmountDeb | currencyFormatPipe : 10 }}</b></p>
                        </article>
                    </div>
                </ng-container>
                <div class="relative w-full px-5">
                    <div class="flex items-center justify-between w-full mx-auto py-2">
                        <article class="prose break-words">
                            <h3>
                                Chi tiết các kỳ thanh toán
                            </h3>
                        </article>
                    </div>
                </div>
                <ng-container *ngIf="(debtManagement | async) as debtManagementData">
                    <table mat-table [dataSource]="debtManagementData.lstFsCardDown" class="overflow-x-auto">
                        <!-- No Column -->
                        <ng-container matColumnDef="no">
                            <th mat-header-cell *matHeaderCellDef> STT </th>
                            <td mat-cell *matCellDef="let idx = index"> {{idx + 1}} </td>
                        </ng-container>

                        <!-- fsCardDownCode Column -->
                        <ng-container matColumnDef="transCode">
                            <th mat-header-cell *matHeaderCellDef> Đợt giải ngân </th>
                            <td mat-cell *matCellDef="let fsCardDown"> {{fsCardDown.transCode}} </td>
                        </ng-container>

                        <!-- amount Column -->
                        <ng-container matColumnDef="amount">
                            <th mat-header-cell *matHeaderCellDef> Số tiền giải ngân(VNĐ) </th>
                            <td mat-cell *matCellDef="let fsCardDown"> {{fsCardDown.amount | currencyFormatPipe : 10}} </td>
                        </ng-container>

                        <!-- amount Column -->
                        <ng-container matColumnDef="amountInteresAtimate">
                            <th mat-header-cell *matHeaderCellDef> Lãi dự kiến(VNĐ) </th>
                            <td mat-cell *matCellDef="let fsCardDown"> {{fsCardDown.amountInteresAtimate | currencyFormatPipe : 10}} </td>
                        </ng-container>

                        <!-- payExpireDate Column -->
                        <ng-container matColumnDef="expirDate">
                            <th mat-header-cell *matHeaderCellDef> Ngày phải thanh toán </th>
                            <td mat-cell *matCellDef="let fsCardDown"> {{fsCardDown.expirDate | datetimeformat: 'DD/MM/YYYY HH:mm:ss'}} </td>
                        </ng-container>

                        <!-- totalDebitPaid Column -->
                        <ng-container matColumnDef="principalAmountDue">
                            <th mat-header-cell *matHeaderCellDef> Gốc đã thanh toán(VNĐ) </th>
                            <td mat-cell *matCellDef="let fsCardDown"> {{fsCardDown.principalAmountDue | currencyFormatPipe : 10}} </td>
                        </ng-container>

                        <!-- totalDebitPaid Column -->
                        <ng-container matColumnDef="interestAmountDue">
                            <th mat-header-cell *matHeaderCellDef> Lãi đã thanh toán(VNĐ) </th>
                            <td mat-cell *matCellDef="let fsCardDown"> {{fsCardDown.interestAmountDue | currencyFormatPipe : 10}} </td>
                        </ng-container>

                        <!-- paidDate Column -->
                        <ng-container matColumnDef="lastPaidDate">
                            <th mat-header-cell *matHeaderCellDef> Ngày thanh toán gần nhất </th>
                            <td mat-cell *matCellDef="let fsCardDown"> {{fsCardDown.lastPaidDate | datetimeformat: 'DD/MM/YYYY HH:mm:ss'}} </td>
                        </ng-container>

                        <!-- statusName Column -->
                        <ng-container matColumnDef="paymentStatus">
                            <th mat-header-cell *matHeaderCellDef> Trạng thái </th>
                            <td mat-cell *matCellDef="let fsCardDown"> {{fsCardDown.paymentStatusName}} </td>
                        </ng-container>

                        <!-- penaltyCash Column -->
                        <ng-container matColumnDef="detail1">
                            <th mat-header-cell *matHeaderCellDef> Lịch sử ghi nhận xử lý</th>
                            <td mat-cell *matCellDef="let fsCardDown">
                                <a style="color: blue"
                                    mat-icon-button
                                    (click)="viewHistoryNote(fsCardDown.fsCardDownId)">
                                    Xem chi tiết
                                </a>
                        </ng-container>

                        <!-- expireAmount Column -->
                        <ng-container matColumnDef="detail2">
                            <th mat-header-cell *matHeaderCellDef> Lịch sử xử lý</th>
                            <td mat-cell *matCellDef="let fsCardDown">
                                <a style="color: blue" class="mx-5"
                                    mat-icon-button
                                    (click)="viewHistoryProcess(fsCardDown.fsCardDownId)">
                                    Xem chi tiết</a>
                            </td>
                        </ng-container>

                        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
                        <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
                    </table>


                </ng-container>
            </ng-container>
        </div>
    </mat-drawer-content>
    <mat-drawer-content class="flex flex-col" *ngIf="viewMode == 2"
                        @fadeOutLeft
                        @slideInLeft>
        <ng-container *ngIf="(debtManagement | async) as debtManagementData">
            <div class="relative w-full px-5">
                <div class="flex items-center justify-between w-full mx-auto py-2">
                    <article class="prose break-words">
                        <h3>
                            Chi tiết ghi nhận xử lý công nợ
                        </h3>
                    </article>
                    <div class="flex items-center justify-end">
                        <a
                            (click)="onCloseHistory()"
                            class="ml-auto sm:ml-0"
                            mat-stroked-button
                            [matTooltip]="'Đóng'"
                        >
                            Đóng
                        </a>
                    </div>
                </div>
            </div>
            <ng-container>
                <ng-container>
                    <div class="p-5 ">
                        <mat-expansion-panel class="m-5" (opened)="setIndexShow(i)" (close)="setIndexShow(-1)"
                                              *ngFor="let fsReportDebtHistory of fsReportDebtHistoryDTOS; let i = index"
                                             [expanded]="i == indexShow">
                            <mat-expansion-panel-header>
                                <mat-panel-title>
                                    {{fsReportDebtHistory.name}}
                                </mat-panel-title>
                            </mat-expansion-panel-header>
                            <div class="grid grid-cols-1 gap-5 p-5">
                                <article class="prose break-words">
                                    <p>Đợt giải ngân: <br>
                                        <b>{{ fsReportDebtHistory.fsCardDownCode }}</b></p>
                                </article>
                            </div>
                            <mat-divider></mat-divider>
                            <div class="grid grid-cols-1 p-5">
                                <article class="prose break-words">
                                    <p>Nội dung xử lý: <br>
                                        <b>{{ fsReportDebtHistory.processingContent }}</b></p>
                                </article>
                            </div>
                            <mat-divider></mat-divider>
                            <div class="grid grid-cols-1 p-5">
                                <article class="file-document prose mt-5">
                                    <p>Tài liệu đính kèm: </p> <br>
                                    <div class="flex flex-wrap">
                                        <file-ui *ngFor="let file of fsReportDebtHistory.finDocumentsIds" [file]="file"
                                                 (click)="onClickFile(file)"></file-ui>
                                    </div>
                                </article>
                            </div>
                            <mat-divider></mat-divider>
                            <div class="grid grid-cols-2 p-5">
                                <article class="prose break-words">
                                    <p>Người tạo: <br>
                                        <b>{{ fsReportDebtHistory.createdByName }}</b></p>
                                </article>
                                <article class="w-1/2 prose break-words">
                                    <p>Ngày lập<br>
                                        <b>{{fsReportDebtHistory.createdDate | datetimeformat: 'DD/MM/YYYY'}}</b>
                                    </p>
                                </article>
                            </div>
                        </mat-expansion-panel>
                    </div>
                </ng-container>
            </ng-container>
        </ng-container>
    </mat-drawer-content>
    <mat-drawer-content class="flex flex-col" *ngIf="viewMode == 3"
                        @fadeOutLeft
                        @slideInLeft>
        <ng-container *ngIf="(debtManagement | async) as debtManagementData">
            <div class="relative w-full px-5">
                <div class="flex items-center justify-between w-full mx-auto py-2">
                    <article class="prose break-words">
                        <h3>
                            Chi tiết xử lý công nợ
                        </h3>
                    </article>
                    <div class="flex items-center justify-end">
                        <a
                            (click)="onCloseHistory()"
                            class="ml-auto sm:ml-0"
                            mat-stroked-button
                            [matTooltip]="'Đóng'"
                        >
                            Đóng
                        </a>
                    </div>
                </div>
            </div>
            <ng-container>
                <div *ngIf="fsReportDebtDTO">
                    <ng-container>
                        <div class="border-b p-5">
                            <div class="grid grid-cols-2 gap-5 mb-5">
                                <article class="prose break-words">
                                    <p>Đợt giải ngân: <br> <b>{{ fsReportDebtDTO.fsCardDownCode }}</b></p>
                                </article>
                                <article class="prose break-words">
                                    <p>Phương án xử lý: <br> <b>{{ fsReportDebtDTO.solutionName }}</b></p>
                                </article>
                            </div>
                            <mat-divider></mat-divider>
                            <div class="grid grid-cols-2 gap-5  mb-5">
                                <article class="prose break-words">
                                    <p>Nội dung xử lý: <br> <b>{{ fsReportDebtDTO.processingContent }}</b></p>
                                </article>
                            </div>
                            <mat-divider></mat-divider>
                            <article class="file-document prose ">
                                <p>Tài liệu đính kèm: </p> <br>
                                <div class="flex flex-wrap">
                                    <file-ui *ngFor="let file of finDocumentsId" [file]="file"
                                             (click)="onClickFile(file)"></file-ui>
                                </div>
                            </article>
                            <mat-divider></mat-divider>
                            <div class="grid grid-cols-2 gap-5 mb-5">
                                <article class="prose break-words">
                                    <p>Ngươi tạo: <br> <b>{{ fsReportDebtDTO.createdByName }}</b></p>
                                </article>
                                <article class="prose break-words">
                                    <p>Ngày tạo: <br> <b>{{ fsReportDebtDTO.createdDate | datetimeformat: 'DD/MM/YYYY' }}</b></p>
                                </article>
                            </div>
                        </div>
                    </ng-container>
                </div>
            </ng-container>
        </ng-container>
    </mat-drawer-content>
    {{viewMode}}
</mat-drawer-container>
